<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Context Menu</title>
    <style>
        #rectangle {
            width: 800px;
            height: 600px;
            border: 2px solid black;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #square {
            width: 100px;
            height: 100px;
            border: 2px solid black;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
    <link rel="stylesheet" href="contextMenu.css">
</head>
<body>
    <div id="heading">Custom Context Menu (right-click popup) applied the larger rectangle.</div>
    <div id="info">
        <a href="https://github.com/shootTheLuck/Context-Menu">Repo on github</a>
    </div>
    <div id="rectangle">
        <div id="instructions">Right-click anywhere inside me for context menu..</div>
        <div id="square" style="background: red"></div>
    </div>

    <div id="feedback"></div>

    <script type="module">
        import {ContextMenu} "./ContextMenu.js";

        var rectangleElement = document.getElementById("rectangle");
        var squareElement = document.getElementById("square");
        var feedback = document.getElementById("feedback");

        // instantiate and append to DOM
        // autoDisplay: false to make adjustments to menu before showing

        var contextMenu = new ContextMenu({autoDisplay: false});
        contextMenu.addMenuOption("Edit");
        contextMenu.addMenuOption("Back");
        contextMenu.addMenuOption("Create");
        rectangleElement.appendChild(contextMenu);

        // if autodisplay = false, listen for rightclick event from contextMenu:

        contextMenu.addEventListener("rightClick", function(evt) {

            // make decisions on what to show in the menu based on target
            // before displaying:

            let targetElement = evt.detail.value.target;
            if (targetElement === squareElement) {
                contextMenu.disableItem("Edit");
                contextMenu.show(evt.detail.value, "Change Color");
            } else {
                contextMenu.show(evt.detail.value);
            }
        });

        // or listen for contextmenu event on page element:

        // rectangleElement.addEventListener("contextmenu", function(evt) {
            // if (evt.target === squareElement) {
                // contextMenu.show(evt, "Change Color");
            // } else {
                // contextMenu.show(evt);
            // }
        // });

        // listen to selection event to find out what was selected

        contextMenu.addEventListener("selection", function(evt) {
            let selectedValue = evt.detail.value;
            feedback.innerText = "You selected: " + selectedValue;

            let targetElement = evt.detail.initialClick.target;
            if (targetElement === squareElement && selectedValue === "Change Color") {
                let color = targetElement.style.backgroundColor;
                if (color === "red") {
                    targetElement.style.backgroundColor = "blue";
                } else {
                    targetElement.style.backgroundColor = "red";
                }
            }
        });

        document.addEventListener("keydown", function(evt) {
            if (evt.key === "t") {
                contextMenu.removeMenuOption("Create");
            }
            if (evt.key === "m") {
                contextMenu.disableItem("Create");
            }
        });
    </script>
</body>
</html>
